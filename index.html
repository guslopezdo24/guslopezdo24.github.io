<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inversi√≥n Inteligente | Finanzas 101</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
        }
        .md-card { 
            background-color: #0f172a; /* bg-slate-900 */
            border-radius: 1.5rem;
            border: 1px solid #1e293b; /* border-slate-800 */
            transition: all 0.3s ease;
        }
        .md-card:hover {
            border-color: #334155; /* border-slate-700 */
        }
        .md-input-container {
            position: relative;
            margin-bottom: 1.5rem;
        }
        .md-input {
            width: 100%;
            border: 1px solid #334155; /* border-slate-700 */
            border-radius: 8px;
            padding: 12px;
            background: #020617; /* bg-slate-950 */
            color: #f8fafc; /* text-slate-50 */
            font-size: 1rem;
            transition: all 0.2s;
        }
        .md-input:focus {
            outline: none;
            border-color: #10b981; /* border-emerald-500 */
            border-width: 2px;
            padding: 11px;
        }
        .md-label {
            position: absolute;
            left: 12px;
            top: -10px;
            background: #0f172a; /* bg-slate-900 */
            padding: 0 4px;
            font-size: 0.75rem;
            color: #10b981; /* text-emerald-500 */
            font-weight: 500;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            height: 380px;
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 antialiased">

    <header class="bg-slate-900/80 backdrop-blur-sm border-b border-slate-800 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-20 flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div id="header-icon" class="flex items-center justify-center w-12 h-12 rounded-2xl text-emerald-400 bg-emerald-500/10">
                    <span id="season-emoji" class="text-2xl">üìä</span>
                </div>
                <div>
                    <h1 class="text-xl font-bold tracking-tight text-slate-50">Calculadora Financiera</h1>
                    <p class="text-xs text-slate-400 uppercase tracking-widest font-semibold" id="season-name">Inter√©s Compuesto</p>
                </div>
            </div>
            <a href="finanzas101.html" class="bg-emerald-500 hover:bg-emerald-400 text-slate-950 font-bold py-2 px-5 rounded-full transition-all hover:scale-105 active:scale-95 text-sm">
                Saber m√°s de finanzas
            </a>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 md:p-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <aside class="lg:col-span-4 space-y-6">
                <div class="md-card p-8">
                    <h2 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-6">Configuraci√≥n</h2>

                    <div class="md-input-container">
                        <label class="md-label">Capital Inicial ($)</label>
                        <input type="number" id="initialCapital" class="md-input" value="0">
                    </div>

                    <div class="md-input-container">
                        <label class="md-label">Tasa Anual (%)</label>
                        <input type="number" id="annualRate" class="md-input" value="9" step="0.1">
                    </div>

                    <div class="md-input-container">
                        <label class="md-label">Plazo (A√±os)</label>
                        <input type="number" id="years" class="md-input" value="2">
                    </div>

                    <div class="md-input-container">
                        <label class="md-label">Pago de Intereses</label>
                        <select id="compoundFrequency" class="md-input">
                            <option value="365">Diario</option>
                            <option value="52">Semanal</option>
                            <option value="12" selected>Mensual</option>
                            <option value="1">Anual</option>
                        </select>
                    </div>

                    <div class="pt-4 border-t border-slate-800 mt-2">
                        <h3 class="text-xs font-bold text-slate-500 uppercase mb-6 mt-4 tracking-tighter">Aportaciones Recurrentes</h3>
                        <div class="md-input-container">
                            <label class="md-label">Monto de Dep√≥sito ($)</label>
                            <input type="number" id="contributionAmount" class="md-input" value="10000">
                        </div>
                        <div class="md-input-container">
                            <label class="md-label">Frecuencia</label>
                            <select id="contributionFrequency" class="md-input">
                                <option value="365">Diaria</option>
                                <option value="52">Semanal</option>
                                <option value="12" selected>Mensual</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="md-card p-6 bg-slate-900/50 border border-slate-800">
                    <p class="text-sm italic text-slate-400 mb-4" id="motivation-quote">"La mejor √©poca para plantar un √°rbol fue hace 20 a√±os. La segunda mejor √©poca es ahora."</p>
                    <div class="flex items-center font-bold text-emerald-400">
                        <span class="mr-2">üìà</span>
                        <span class="text-xs uppercase">Meta: Libertad Financiera</span>
                    </div>
                </div>
            </aside>

            <div class="lg:col-span-8 space-y-8">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="md-card p-6 border-l-8 border-emerald-500">
                        <p class="text-xs font-bold text-slate-400 uppercase mb-1">Saldo Final</p>
                        <p id="resFinalBalance" class="text-3xl font-bold text-slate-50">$0.00</p>
                    </div>
                    <div class="md-card p-6 border-l-8 border-blue-500">
                        <p class="text-xs font-bold text-slate-400 uppercase mb-1">Total Aportado</p>
                        <p id="resTotalDeposits" class="text-3xl font-bold text-slate-50">$0.00</p>
                    </div>
                    <div class="md-card p-6 border-l-8 border-amber-500">
                        <p class="text-xs font-bold text-slate-400 uppercase mb-1">Cosecha (Inter√©s)</p>
                        <p id="resTotalInterest" class="text-3xl font-bold text-slate-50">$0.00</p>
                    </div>
                </div>

                <div class="md-card p-8">
                    <h3 class="text-xl font-bold text-slate-100 mb-8 flex items-center">
                        <span class="mr-2">üìà</span> An√°lisis de Crecimiento
                    </h3>
                    <div class="chart-container">
                        <canvas id="investmentChart"></canvas>
                    </div>
                </div>

                <div class="md-card overflow-hidden">
                    <div class="p-6 border-b border-slate-800">
                        <h3 class="font-bold text-slate-300 uppercase text-sm tracking-widest">Reporte de Resultados</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-950 text-slate-400 text-xs uppercase tracking-widest">
                                <tr>
                                    <th class="px-8 py-4 font-bold">A√±o</th>
                                    <th class="px-8 py-4 font-bold">Aportado</th>
                                    <th class="px-8 py-4 font-bold">Inter√©s Acum.</th>
                                    <th class="px-8 py-4 font-bold text-right">Saldo Total</th>
                                </tr>
                            </thead>
                            <tbody id="summaryTableBody" class="text-sm divide-y divide-slate-800"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Desglose Mensual -->
                <div class="md-card overflow-hidden">
                    <div class="p-6 border-b border-slate-800">
                        <h3 class="font-bold text-slate-300 uppercase text-sm tracking-widest">Desglose Mensual</h3>
                    </div>
                    <div class="overflow-x-auto max-h-[400px] overflow-y-auto">
                        <table class="w-full text-left relative">
                            <thead class="bg-slate-900 text-slate-400 text-xs uppercase tracking-widest sticky top-0 shadow-sm z-10">
                                <tr>
                                    <th class="px-8 py-4 font-bold">Mes</th>
                                    <th class="px-8 py-4 font-bold">Aportado</th>
                                    <th class="px-8 py-4 font-bold">Inter√©s Acum.</th>
                                    <th class="px-8 py-4 font-bold text-right">Saldo Total</th>
                                </tr>
                            </thead>
                            <tbody id="monthlyTableBody" class="text-sm divide-y divide-slate-800"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let myChart = null;

        const chartColors = {
            primary: '#10b981',   // emerald-500
            secondary: '#3b82f6', // blue-500
            accent: '#f59e0b'     // amber-500
        };

        function formatCurrency(v) {
            return new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' }).format(v);
        }

        function calculate() {
            const initialCapital = parseFloat(document.getElementById('initialCapital').value) || 0;
            const annualRate = (parseFloat(document.getElementById('annualRate').value) || 0) / 100;
            const years = parseInt(document.getElementById('years').value) || 1;
            const compoundFreq = parseInt(document.getElementById('compoundFrequency').value);
            const contributionAmount = parseFloat(document.getElementById('contributionAmount').value) || 0;
            const contributionFreq = parseInt(document.getElementById('contributionFrequency').value);

            let currentBalance = initialCapital;
            let totalDeposited = initialCapital;
            let totalInterest = 0;
            let accruedInterest = 0;

            const daysInYear = 365;
            const totalDays = years * daysInYear;
            const dailyRate = annualRate / daysInYear;
            
            const depositInterval = daysInYear / contributionFreq;
            const capitalizationInterval = daysInYear / compoundFreq;

            const chartLabels = ['Inicio'];
            const dataInitial = [initialCapital];
            const dataDeposits = [0];
            const dataInterests = [0];
            const tableData = [];
            const monthlyTableData = [];

            let nextDepositDay = 1;
            let nextCapDay = capitalizationInterval;
            const maxTotalDeposits = initialCapital + (contributionAmount * contributionFreq * years);
            
            const daysInMonth = daysInYear / 12;
            let nextMonthSnapshot = daysInMonth;
            let monthCounter = 1;

            for (let day = 1; day <= totalDays; day++) {
                if (day >= Math.floor(nextDepositDay) && totalDeposited < maxTotalDeposits) {
                    currentBalance += contributionAmount;
                    totalDeposited += contributionAmount;
                    nextDepositDay += depositInterval;
                }

                let interestToday = currentBalance * dailyRate;
                accruedInterest += interestToday;

                if (day >= Math.floor(nextCapDay)) {
                    currentBalance += accruedInterest;
                    totalInterest += accruedInterest;
                    accruedInterest = 0;
                    nextCapDay += capitalizationInterval;
                }

                if (day % daysInYear === 0) {
                    const year = day / daysInYear;
                    chartLabels.push(`A√±o ${year}`);
                    dataInitial.push(initialCapital);
                    dataDeposits.push(totalDeposited - initialCapital);
                    dataInterests.push(totalInterest);
                    tableData.push({ year, deposits: totalDeposited, interest: totalInterest, total: currentBalance });
                }

                if (day >= Math.floor(nextMonthSnapshot) && monthCounter <= years * 12) {
                    monthlyTableData.push({ month: monthCounter, deposits: totalDeposited, interest: totalInterest, total: currentBalance });
                    monthCounter++;
                    nextMonthSnapshot += daysInMonth;
                }
            }

            document.getElementById('resFinalBalance').innerText = formatCurrency(currentBalance);
            document.getElementById('resTotalDeposits').innerText = formatCurrency(totalDeposited);
            document.getElementById('resTotalInterest').innerText = formatCurrency(totalInterest);

            const tableBody = document.getElementById('summaryTableBody');
            tableBody.innerHTML = '';
            tableData.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-slate-800/50 transition-colors duration-200';
                tr.innerHTML = `
                    <td class="px-8 py-4 font-semibold text-slate-100">A√±o ${row.year}</td>
                    <td class="px-8 py-4 text-slate-400">${formatCurrency(row.deposits)}</td>
                    <td class="px-8 py-4 text-slate-400">${formatCurrency(row.interest)}</td>
                    <td class="px-8 py-4 text-right font-bold text-emerald-400">${formatCurrency(row.total)}</td>
                `;
                tableBody.appendChild(tr);
            });

            const monthlyTableBody = document.getElementById('monthlyTableBody');
            monthlyTableBody.innerHTML = '';
            monthlyTableData.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-slate-800/50 transition-colors duration-200';
                tr.innerHTML = `
                    <td class="px-8 py-4 font-semibold text-slate-100">Mes ${row.month}</td>
                    <td class="px-8 py-4 text-slate-400">${formatCurrency(row.deposits)}</td>
                    <td class="px-8 py-4 text-slate-400">${formatCurrency(row.interest)}</td>
                    <td class="px-8 py-4 text-right font-bold text-emerald-400">${formatCurrency(row.total)}</td>
                `;
                monthlyTableBody.appendChild(tr);
            });

            updateChart(chartLabels, dataInitial, dataDeposits, dataInterests);
        }

        function updateChart(labels, initial, deposits, interests) {
            const ctx = document.getElementById('investmentChart').getContext('2d');
            
            if (myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Capital', data: initial, backgroundColor: chartColors.primary, borderRadius: 5 },
                        { label: 'Ahorro', data: deposits, backgroundColor: chartColors.secondary, borderRadius: 5 },
                        { label: 'Inter√©s', data: interests, backgroundColor: chartColors.accent, borderRadius: 5 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20, color: '#94a3b8' } },
                        tooltip: { backgroundColor: 'rgba(0,0,0,0.8)', padding: 12, titleColor: '#fff', bodyColor: '#fff' }
                    },
                    scales: {
                        x: { 
                            stacked: true, 
                            grid: { display: false },
                            ticks: { color: '#94a3b8' }
                        },
                        y: { 
                            stacked: true, 
                            grid: { color: '#1e293b' },
                            ticks: { color: '#94a3b8', callback: v => '$' + v.toLocaleString() } 
                        }
                    }
                }
            });
        }

        const inputs = ['initialCapital', 'annualRate', 'years', 'compoundFrequency', 'contributionAmount', 'contributionFrequency'];
        inputs.forEach(id => document.getElementById(id).addEventListener('input', calculate));
        
        window.onload = calculate;
    </script>
</body>
</html>
